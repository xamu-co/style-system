@use "../utils/module" as utils;
@use "sass:meta";
@use "sass:math";

@function tableThemeSelector($name) {
	@return ".#{utils.$prefix__default}--tm-#{$name}";
}

// Table
// tbl instead of table to not crash with other libraries such as bootstrap
@mixin table {
	table.#{utils.$layout__table} {
		table-layout: fixed;
		border-collapse: collapse;
		box-sizing: border-box;
		border-spacing: 0;

		@layer defaults {
			& {
				// @defaults txtColor
				color: utils.$color__text;
			}

			tr {
				th,
				td {
					// @defaults txtAlign
					text-align: left;
				}
			}
		}

		thead {
			z-index: 3;
			tr {
				th,
				td {
					&.#{utils.$status__isSelected} {
						font-weight: utils.weight(bold);
					}
					*:not(i.#{utils.$component__icon}) {
						font-weight: inherit;
					}
				}
			}
		}
		thead,
		tbody {
			width: 100%;
			tr {
				border-bottom: 2px solid transparent;
				transition: all 0.1s ease-out;
				th,
				td {
					padding: 0.5rem 1rem;
					transition: color 0.1s ease-out;
					font-weight: utils.weight();
					&:before {
						content: "";
						display: block;
						width: 100%;
						height: 100%;
						position: absolute;
						top: 0;
						left: 0;
						z-index: 0;
						pointer-events: none;
						transition: all 0.1s ease-out;
						border-top: 2px solid transparent;
						border-bottom: 2px solid transparent;
						box-sizing: border-box;
					}
					&:first-child:before {
						border-top-left-radius: 0.7rem;
						border-bottom-left-radius: 0.7rem;
						border-left: 2px solid transparent;
					}
					&:last-child {
						&:before,
						&.#{utils.$prefix__default}--sticky:before {
							border-top-right-radius: 0.7rem;
							border-bottom-right-radius: 0.7rem;
							border-right: 2px solid transparent;
						}
					}
					&.#{utils.$prefix__default}--sticky {
						position: sticky;
						z-index: 2;
						background: utils.color(light);
						left: 0;
						width: 0%; // fit width to content
						&:hover {
							z-index: 3;
						}
						&:empty {
							padding: 0.5rem 0.35rem;
							pointer-events: none;
						}
						&:last-child {
							right: 0;
						}
					}
				}
				td {
					min-width: math.div(utils.$size__minColumnSize, 3);
				}
			}
		}

		// table theme
		//
		// @group Modifiers
		@include utils.extend-color-modifiers(
				meta.get-function("tableThemeSelector"),
				utils.$themeColors
			)
			using($name, $value, $isDefault) {
			thead {
				tr {
					color: utils.color($name, 0.6);
					&:hover {
						th:before,
						td:before {
							border-color: utils.color($name, 0.05);
						}
					}
					th,
					td {
						&.#{utils.$status__isSelected} {
							color: $value;
						}
						&:before {
							background: utils.color($name, 0.1);
						}
					}
				}
			}
			tbody {
				tr {
					&.#{utils.$status__isSelected} {
						&:hover {
							th:before,
							td:before {
								border-color: utils.color($name, 0.3);
							}
						}
						th:before,
						td:before {
							border-color: utils.color($name, 0.1);
						}
					}
					&:hover,
					&.#{utils.$status__isSelected} {
						color: $value;
						th:before,
						td:before {
							background: utils.color($name, 0.1);
						}
					}
				}
			}
		}

		@if (utils.$allow__responsive) {
			@media (max-width: utils.$mediaQuerie__tablet) {
				// TODO: fix this
				&.#{utils.$prefix__default}--collapseOnMobile {
					&,
					thead,
					tbody,
					th,
					td,
					tr {
						display: block;
					}
					thead {
						position: absolute;
						top: -9999px;
						left: -9999px;
					}
					tbody {
						th,
						td {
							/* Behave  like a "row" */
							// border: none;
							// border-bottom: 1px solid #eee;
							// position: relative;
							// padding-left: 50%;
							@include utils.flex-box(
								row,
								nowrap,
								flex-start,
								center
							);
							&[data-column]:before {
								content: attr(data-column);
							}
							&:before {
								/* Now like a table header */
								content: "Column";
								width: 30%;
								// position: absolute;
								// /* Top/left values mimic padding */
								// top: 6px;
								// left: 6px;
								// width: 45%;
								flex: 0 0 auto;
								height: 100%;
								padding-right: 1rem;
								white-space: pre-line;
								overflow: hidden;
								text-overflow: ellipsis;
								@include utils.flex-box(
									row,
									nowrap,
									flex-start,
									center
								);
							}
						}
						td {
						}
					}
				}
			}
		}
	}
}
