// grid Gap
// both dimension
//
// @group GlobalModifiers
// gap using margin
// both axis
// this class applies to any container, not just flex containers, so it can't be polyfilled
//
// @group GlobalModifiers
.xm__gap {
	// flex, column & grid only
	@include extend-viewports-classes {
		--gp: 1rem;
	}
	&-none {
		@include extend-viewports-classes {
			--gp: 0;
		}
	}
}
.xm__gapX {
	// flex, column & grid only, X axis
	@include extend-viewports-classes {
		--gpx: 1rem;
	}
	&-none {
		@include extend-viewports-classes {
			--gpx: 0;
		}
	}
}
.xm__gapY {
	// flex, column & grid only, Y axis
	@include extend-viewports-classes {
		--gpy: 1rem;
	}
	&-none {
		@include extend-viewports-classes {
			--gpy: 0;
		}
	}
}

.xm__gaping {
	@include extend-viewports-classes {
		--g: 1rem;
	}
}
.xm__gapingX {
	// X dimension
	@include extend-viewports-classes {
		> * {
			--gx: 1rem;
		}
	}
}
.xm__gapingY {
	// Y dimension
	@include extend-viewports-classes {
		> * {
			--gy: 1rem;
		}
	}
}

@for $i from 1 through 10 {
	// grid Gap, future flex gap
	.xm__gap-#{$i*5} {
		// flex, column & grid only
		@include extend-viewports-classes {
			--gp: #{$i/3}rem;
		}
	}
	.xm__gapX-#{$i*5} {
		// flex, column & grid only, X axis
		@include extend-viewports-classes {
			--gpx: #{$i/3}rem;
		}
	}
	.xm__gapY-#{$i*5} {
		// flex, column & grid only, Y axis
		@include extend-viewports-classes {
			--gpy: #{$i/3}rem;
		}
	}

	// Gaping
	.xm__gaping-#{$i*5} {
		@include extend-viewports-classes {
			--g: #{$i/3}rem;
		}
	}
	.xm__gapingX-#{$i*5} {
		@include extend-viewports-classes {
			> * {
				--gx: #{$i/3}rem;
			}
		}
	}
	.xm__gapingY-#{$i*5} {
		@include extend-viewports-classes {
			> * {
				--gy: #{$i/3}rem;
			}
		}
	}
}

// item spacing defaults
[class*="__gapi"]:not([class*="ngX"]):not([class*="ngY"]):not([class*="__gaping-no"]) {
	// this is a very special class to omit this specific fix
	&:not(.unfix__gaping) {
		--gc: calc(-1 * var(--g, 1rem)); // calculated gap
		// TODO: fix mX & mY collision in gaping modifier
		// TODO: fix margin not collapsing when nowrap child is affected
		margin: -0.1px var(--gc) var(--gc) -0.1px;
		box-sizing: border-box;
		&:last-child > :first-child:last-child {
			// only child, text nodes can break this
			margin: 0;
		}
	}
	> :not(br):not(.xm__m):not(.xm__margin):not([class*="__mX"]):not([class*="__mY"]) {
		&:not([class*="__mT"]):not([class*="__mL"]):not([class*="__mB"]):not([class*="__mR"]) {
			&[class*="__txtWr"]:not([class*="__flx"]),
			&:not([class*="-wrap"]):not([class*="-reverse"]) {
				// Wrap, omit fallback
				margin-bottom: var(--g);
				margin-right: var(--g);
				&:not([class*="__gap"]) > :not([class*="__gap"]) {
					--g: initial;
				}
			}
			// override gapinp fix on childs (affects wrap)
			--gc: 0 var(--g) var(--g) 0;
		}
	}
}

// X axis
// because of the fix is necesary to transfer the margin to the sibling element
[class*="ngX"]:not([class*="ngX-no"]) {
	> :not(br):not(:last-child):not([class*="__mR"]):not(.unfix__gaping) {
		// Right
		&:not(.xm__gaping):not([class*="__gaping:"]):not([class*="__gaping-"]) {
			// margin-right: var(--gx); // omit fallback
			margin-right: var(--gxc, var(--gx)); // omit fallback
			&[class*="__flx"][class*="-wrap"],
			&[class*="__flx"][class*="-reverse"],
			&[class*="__gapi"]:not([class*="ngX"]):not([class*="ngY"]):not([class*="__gaping-no"]) {
				// --gx: calc(-1 * (var(--g, 1rem) - var(--gx, 1rem)));
				--gxc: var(--gxc, calc(var(--gc) + var(--gx)));
			}
		}
	}
}
// Y axis
// because of the fix is necesary to transfer the margin to the sibling element
[class*="ngY"]:not([class*="ngY-no"]) {
	> :not(br):not(:last-child):not([class*="__mB"]):not(.unfix__gaping) {
		// Bottom
		&:not(.xm__gaping):not([class*="__gaping:"]):not([class*="__gaping-"]) {
			// margin-bottom: var(--gy); // omit fallback
			margin-bottom: var(--gyc, var(--gy)); // omit fallback
			&[class*="__flx"][class*="-wrap"],
			&[class*="__flx"][class*="-reverse"],
			&[class*="__gapi"]:not([class*="ngX"]):not([class*="ngY"]):not([class*="__gaping-no"]) {
				// --gy: calc(-1 * (var(--g, 1rem) - var(--gy, 1rem)));
				--gyc: var(--gyc, calc(var(--gc) + var(--gy)));
			}
		}
	}
}
